<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Commission Rebate Agreement - OSUS Real Estate Brokerage L.L.C">
    <meta name="author" content="OSUS Real Estate Brokerage L.L.C">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Commission Rebate Agreement - OSUS Real Estate Brokerage L.L.C</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: transparent;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }
        
        body.standalone {
            background: linear-gradient(135deg, #6b1a3d 0%, #8b2449 50%, #4a0e24 100%);
            padding: 20px;
        }
        
        body.standalone .container {
            max-width: 900px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #722f37 0%, #8b2449 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        body.standalone .header {
            padding: 40px;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        body.standalone .header h1 {
            font-size: 2.2em;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }
        
        body.standalone .content {
            padding: 40px;
        }

        .company-info {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0e6e9;
        }

        .company-logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .company-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .company-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #722f37;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .company-details {
            color: #666;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .company-details p {
            margin: 3px 0;
        }

        .letter-ref {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background: #faf7f8;
            border-radius: 8px;
            border-left: 4px solid #8b2449;
        }

        .ref-item {
            display: flex;
            flex-direction: column;
        }

        .ref-label {
            color: #722f37;
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .ref-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d4b5bd;
            border-radius: 4px;
            font-size: 0.95em;
        }

        .ref-input:focus {
            outline: none;
            border-color: #8b2449;
        }

        .section-title {
            color: #722f37;
            font-size: 1.4em;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b2449;
        }

        .detail-section {
            background: #faf7f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #8b2449;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            margin-bottom: 12px;
            align-items: center;
        }

        .detail-label {
            color: #722f37;
            font-weight: 600;
            font-size: 0.95em;
        }

        .detail-value {
            padding: 8px;
            border: 1px solid #d4b5bd;
            border-radius: 4px;
            background: white;
            font-size: 0.95em;
        }

        .detail-value:focus {
            outline: none;
            border-color: #8b2449;
        }

        .financial-highlight {
            background: linear-gradient(135deg, rgba(114, 47, 55, 0.1) 0%, rgba(139, 36, 73, 0.15) 100%);
            border: 2px solid #8b2449;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .financial-highlight .amount-label {
            color: #722f37;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .financial-highlight .amount-value {
            font-size: 2em;
            color: #8b2449;
            font-weight: bold;
            margin: 10px 0;
        }

        .terms-section {
            background: #faf7f8;
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
            border-left: 4px solid #8b2449;
        }

        .term-item {
            margin-bottom: 18px;
            padding-left: 25px;
            position: relative;
            color: #333;
            line-height: 1.7;
        }

        .term-item:before {
            content: "‚óè";
            position: absolute;
            left: 5px;
            color: #8b2449;
            font-size: 1.2em;
        }

        .term-number {
            color: #722f37;
            font-weight: bold;
            display: inline-block;
            margin-right: 8px;
        }

        .acknowledgment-box {
            background: linear-gradient(135deg, rgba(114, 47, 55, 0.05) 0%, rgba(139, 36, 73, 0.08) 100%);
            border: 2px dashed #8b2449;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            text-align: center;
        }

        .acknowledgment-box p {
            color: #722f37;
            font-weight: 600;
            line-height: 1.7;
        }

        .checkbox-agreement {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        .checkbox-agreement input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-agreement label {
            cursor: pointer;
            color: #722f37;
            font-weight: 600;
        }

        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0e6e9;
        }

        .signature-block {
            text-align: center;
        }

        .signature-pad-container {
            margin: 20px 0;
            position: relative;
        }

        .signature-canvas {
            border: 2px dashed #8b2449;
            border-radius: 8px;
            background: white;
            cursor: crosshair;
            touch-action: none;
            width: 100%;
            height: 150px;
            display: block;
        }

        .signature-canvas:active {
            cursor: grabbing;
        }

        .signature-controls {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .signature-controls button {
            padding: 6px 15px;
            border: 1px solid #722f37;
            background: white;
            color: #722f37;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .signature-controls button:hover {
            background: #722f37;
            color: white;
        }

        .signature-label {
            color: #722f37;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-align: center;
        }

        .signature-image {
            display: none;
            max-width: 100%;
            height: auto;
            margin: 10px auto;
        }

        .signature-line {
            border-top: 2px solid #722f37;
            margin-top: 20px;
            padding-top: 15px;
        }

        .signature-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #722f37;
            margin-bottom: 5px;
        }

        .signature-title {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .signature-date {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }

        .footer {
            background: #faf7f8;
            padding: 25px;
            text-align: center;
            color: #666;
            font-size: 0.85em;
            line-height: 1.6;
            border-top: 2px solid #f0e6e9;
        }

        .footer strong {
            color: #722f37;
            display: block;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: #f0e6e9;
            border-radius: 8px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #722f37 0%, #8b2449 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(114, 47, 55, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(114, 47, 55, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #722f37;
            border: 2px solid #722f37;
        }

        .btn-secondary:hover {
            background: #722f37;
            color: white;
        }

        .success-message {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .error-message {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .required {
            color: #dc3545;
            font-weight: bold;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
            }
            
            .action-buttons,
            .signature-controls {
                display: none !important;
            }

            .signature-canvas {
                display: none !important;
            }

            .signature-image {
                display: block !important;
                border: 1px solid #ccc;
                padding: 5px;
                min-height: 100px;
            }

            .success-message,
            .error-message {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .letter-ref {
                grid-template-columns: 1fr;
            }
            
            .detail-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .signature-section {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .content {
                padding: 15px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .signature-canvas {
                height: 120px;
            }
        }
        
        @media (min-width: 769px) {
            .container {
                max-width: 900px;
            }
        }
    </style>


    <div class="container">
        
        <div class="header">
            <h1>COMMISSION REBATE AGREEMENT</h1>
            <p>Official Financial Documentation</p>
        </div>

        
        <form id="rebateForm" action="https://formspree.io/f/mblnyere" method="POST">
            <div class="content">
                
                <div class="company-info">
                    <div class="company-logo">
                        <img src="https://osusproperties.com/images/osus.png" alt="OSUS Real Estate Brokerage Logo" loading="lazy">
                    </div>
                    <div class="company-name">OSUS REAL ESTATE BROKERAGE L.L.C</div>
                    <div class="company-details">
                        <p>Dubai, United Arab Emirates</p>
                        <p>Licensed by Dubai Land Department</p>
                        <p>RERA Registration Number: [Registration Number]</p>
                    </div>
                </div>

                
                <div class="success-message" id="successMessage">
                    ‚úì Form submitted successfully! We will contact you soon.
                </div>
                <div class="error-message" id="errorMessage">
                    ‚úó There was an error submitting the form. Please try again.
                </div>

                
                <div class="letter-ref">
                    <div class="ref-item">
                        <div class="ref-label">Agreement Date <span class="required">*</span></div>
                        <input type="date" class="ref-input" id="agreementDate" name="agreement_date" required="">
                    </div>
                    <div class="ref-item">
                        <div class="ref-label">Reference Number <span class="required">*</span></div>
                        <input type="text" class="ref-input" id="referenceNumber" name="reference_number" placeholder="CRA-2024-XXXX" required="">
                    </div>
                    <div class="ref-item">
                        <div class="ref-label">Recipient Name <span class="required">*</span></div>
                        <input type="text" class="ref-input" id="recipientName" name="recipient_name" placeholder="Full legal name" required="">
                    </div>
                    <div class="ref-item">
                        <div class="ref-label">Transaction Reference <span class="required">*</span></div>
                        <input type="text" class="ref-input" id="transactionRef" name="transaction_reference" placeholder="TXN-XXXX" required="">
                    </div>
                </div>

                
                <div style="text-align: justify; line-height: 1.8; color: #333; margin-bottom: 25px;">
                    <p style="margin-bottom: 15px;">
                        <strong>RE: Commission Rebate Arrangement</strong>
                    </p>
                    <p>
                        This Commission Rebate Agreement ("<strong>Agreement</strong>") is entered into by and between 
                        <strong>OSUS Real Estate Brokerage L.L.C</strong> ("<strong>Brokerage</strong>") and the party 
                        identified below ("<strong>Recipient</strong>"), concerning the rebate of commission proceeds 
                        derived from a real estate transaction as detailed herein.
                    </p>
                </div>

                
                <div class="section-title">1. RECIPIENT INFORMATION</div>
                <div class="detail-section">
                    <div class="detail-row">
                        <div class="detail-label">Full Legal Name: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="fullName" name="full_legal_name" placeholder="As per official ID" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Passport Number: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="passportNumber" name="passport_number" placeholder="Passport number" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Emirates ID: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="emiratesId" name="emirates_id" placeholder="784-XXXX-XXXXXXX-X" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Contact Number: <span class="required">*</span></div>
                        <input type="tel" class="detail-value" id="contactNumber" name="contact_number" placeholder="+971 XX XXX XXXX" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Email Address: <span class="required">*</span></div>
                        <input type="email" class="detail-value" id="emailAddress" name="email_address" placeholder="email@example.com" required="">
                    </div>
                </div>

                
                <div class="section-title">2. TRANSACTION DETAILS</div>
                <div class="detail-section">
                    <div class="detail-row">
                        <div class="detail-label">Property/Project: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="propertyProject" name="property_project" placeholder="Full property/project name" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Developer: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="developer" name="developer" placeholder="Developer name" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Unit Number: <span class="required">*</span></div>
                        <input type="text" class="detail-value" id="unitNumber" name="unit_number" placeholder="Unit/Plot number" required="">
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Sale Date: <span class="required">*</span></div>
                        <input type="date" class="detail-value" id="saleDate" name="sale_date" required="">
                    </div>
                </div>

                
                <div class="section-title">3. REBATE TERMS</div>
                <div class="financial-highlight">
                    <div class="amount-label">Commission Rebate Entitlement</div>
                    <div style="margin: 15px 0;">
                        <input type="number" class="ref-input" id="rebatePercentage" name="rebate_percentage" placeholder="%" style="width: 100px; text-align: center; font-size: 1.2em; font-weight: bold;" step="0.01" min="0" max="100" required="">
                        <span style="font-size: 1.2em; color: #722f37; font-weight: bold; margin-left: 5px;">%</span>
                    </div>
                    <div style="color: #666; font-size: 0.95em; margin-top: 15px;">
                        of the total developer's commission received by OSUS Real Estate Brokerage L.L.C
                    </div>
                </div>

                
                <div class="section-title">4. TERMS AND CONDITIONS</div>
                <div class="terms-section">
                    <div class="term-item">
                        <span class="term-number">4.1 Payment Contingency:</span>
                        The rebate payment is strictly contingent upon the Brokerage's receipt of the full commission 
                        payment from the developer. No obligation to pay shall arise until such funds are received and 
                        cleared in the Brokerage's account.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.2 Qualification Requirements:</span>
                        The rebate shall only be released once the underlying transaction has qualified for commission 
                        payment in accordance with the developer's commission policy and all contractual obligations have 
                        been satisfied.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.3 Payment Timeline:</span>
                        Subject to receipt of commission from the developer, the rebate shall be processed and disbursed 
                        within fifteen (15) business days following confirmation of fund receipt.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.4 Payment Method:</span>
                        All rebate payments shall be made via bank transfer to the Recipient's designated bank account 
                        or through other mutually agreed payment methods compliant with UAE regulations.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.5 Tax Responsibilities:</span>
                        The Recipient acknowledges sole responsibility for any tax obligations, reporting requirements, 
                        or financial compliance matters arising from the receipt of this rebate payment.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.6 Documentation Requirements:</span>
                        The Recipient agrees to provide all necessary documentation, including valid identification, 
                        bank account details, and any other documents reasonably requested by the Brokerage to facilitate 
                        payment.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.7 Amendment or Cancellation:</span>
                        This Agreement may be amended or cancelled only by mutual written consent of both parties or in 
                        the event the underlying transaction fails to complete or qualify for commission payment.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.8 Regulatory Compliance:</span>
                        This Agreement is subject to all applicable laws and regulations of the Dubai Real Estate 
                        Regulatory Authority (RERA) and the United Arab Emirates.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.9 Dispute Resolution:</span>
                        Any disputes arising from this Agreement shall be resolved through amicable negotiation. If 
                        resolution cannot be reached, parties agree to submit to the jurisdiction of Dubai courts.
                    </div>
                    
                    <div class="term-item">
                        <span class="term-number">4.10 Confidentiality:</span>
                        Both parties agree to maintain the confidentiality of the terms and conditions of this Agreement 
                        except as required by law or regulatory authorities.
                    </div>
                </div>

                
                <div class="acknowledgment-box">
                    <p>
                        <strong>ACKNOWLEDGMENT:</strong> By signing below, both parties acknowledge that they have read, 
                        understood, and agree to be bound by all terms and conditions outlined in this Agreement.
                    </p>
                    <div class="checkbox-agreement">
                        <input type="checkbox" id="agreeTerms" name="agree_terms" required="" value="yes">
                        <label for="agreeTerms">I have read and agree to all terms and conditions <span class="required">*</span></label>
                    </div>
                </div>

                
                <div class="signature-section">
                    
                    <div class="signature-block">
                        <div class="signature-label">Company Authorized Signature <span class="required">*</span></div>
                        <div class="signature-pad-container">
                            <canvas id="companySignatureCanvas" class="signature-canvas"></canvas>
                            <img id="companySignatureImage" class="signature-image" alt="Company Signature" loading="lazy">
                            <input type="hidden" id="companySignatureData" name="company_signature">
                            <div class="signature-controls">
                                <button type="button" onclick="clearSignature('company')">üóëÔ∏è Clear</button>
                                <button type="button" onclick="undoSignature('company')">‚Ü∂ Undo</button>
                            </div>
                        </div>
                        <div class="signature-line">
                            <div class="signature-name">Hisham El Assaad</div>
                            <div class="signature-title">Founder</div>
                            <div class="signature-title">OSUS Real Estate Brokerage L.L.C</div>
                            <div class="signature-date">
                                Date: <input type="date" class="ref-input" name="company_signature_date" id="companySignatureDate" style="width: 150px; display: inline-block;" required="">
                            </div>
                        </div>
                    </div>
                    
                    
                    <div class="signature-block">
                        <div class="signature-label">Recipient Signature <span class="required">*</span></div>
                        <div class="signature-pad-container">
                            <canvas id="recipientSignatureCanvas" class="signature-canvas"></canvas>
                            <img id="recipientSignatureImage" class="signature-image" alt="Recipient Signature" loading="lazy">
                            <input type="hidden" id="recipientSignatureData" name="recipient_signature">
                            <div class="signature-controls">
                                <button type="button" onclick="clearSignature('recipient')">üóëÔ∏è Clear</button>
                                <button type="button" onclick="undoSignature('recipient')">‚Ü∂ Undo</button>
                            </div>
                        </div>
                        <div class="signature-line">
                            <div class="signature-name" id="recipientSignatureName">_______________________</div>
                            <div class="signature-title">Recipient Name</div>
                            <div class="signature-title">Signature</div>
                            <div class="signature-date">
                                Date: <input type="date" class="ref-input" id="recipientSignatureDate" name="recipient_signature_date" style="width: 150px; display: inline-block;" required="">
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        üì§ Submit Agreement
                    </button>
                    <button type="button" class="btn btn-primary" onclick="preparePrintAndPrint()">
                        üñ®Ô∏è Print Agreement
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        üîÑ Clear Form
                    </button>
                </div>
            </div>
        </form>

        
        <div class="footer">
            <strong>OSUS REAL ESTATE BROKERAGE L.L.C</strong>
            <p>This document constitutes a binding agreement between the parties and should be retained for record-keeping purposes.</p>
            <p>For inquiries, please contact: info@osusproperties.com | +971 43364500</p>
            <p style="margin-top: 10px; font-size: 0.8em; color: #999;">
                Generated on <span id="generatedDate"></span>
            </p>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Signature Pad Implementation
        class SignaturePad {
            constructor(canvas, type) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.type = type;
                this.isDrawing = false;
                this.lastX = 0;
                this.lastY = 0;
                this.strokes = [];
                this.currentStroke = [];
                
                this.setupCanvas();
                this.bindEvents();
            }

            setupCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.ctx.scale(2, 2);
                
                this.ctx.strokeStyle = '#000000';
                this.ctx.lineWidth = 2;
                this.ctx.lineCap = 'round';
                this.ctx.lineJoin = 'round';
            }

            bindEvents() {
                // Mouse events
                this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
                this.canvas.addEventListener('mousemove', (e) => this.draw(e));
                this.canvas.addEventListener('mouseup', () => this.stopDrawing());
                this.canvas.addEventListener('mouseout', () => this.stopDrawing());

                // Touch events
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startDrawing(e.touches[0]);
                });
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.draw(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.stopDrawing();
                });
            }

            getCoordinates(e) {
                const rect = this.canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }

            startDrawing(e) {
                this.isDrawing = true;
                const coords = this.getCoordinates(e);
                this.lastX = coords.x;
                this.lastY = coords.y;
                this.currentStroke = [{x: coords.x, y: coords.y}];
            }

            draw(e) {
                if (!this.isDrawing) return;
                
                const coords = this.getCoordinates(e);
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.lastX, this.lastY);
                this.ctx.lineTo(coords.x, coords.y);
                this.ctx.stroke();
                
                this.currentStroke.push({x: coords.x, y: coords.y});
                this.lastX = coords.x;
                this.lastY = coords.y;
            }

            stopDrawing() {
                if (this.isDrawing && this.currentStroke.length > 0) {
                    this.strokes.push([...this.currentStroke]);
                    this.updateSignatureData();
                }
                this.isDrawing = false;
                this.currentStroke = [];
            }

            clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.strokes = [];
                this.updateSignatureData();
            }

            undo() {
                if (this.strokes.length > 0) {
                    this.strokes.pop();
                    this.redraw();
                    this.updateSignatureData();
                }
            }

            redraw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.strokes.forEach(stroke => {
                    if (stroke.length > 0) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(stroke[0].x, stroke[0].y);
                        stroke.forEach(point => {
                            this.ctx.lineTo(point.x, point.y);
                        });
                        this.ctx.stroke();
                    }
                });
            }

            updateSignatureData() {
                const dataURL = this.canvas.toDataURL('image/png');
                document.getElementById(`${this.type}SignatureData`).value = dataURL;
                document.getElementById(`${this.type}SignatureImage`).src = dataURL;
            }

            isEmpty() {
                return this.strokes.length === 0;
            }
        }

        // Initialize signature pads
        let companySignaturePad, recipientSignaturePad;

        function initSignaturePads() {
            const companyCanvas = document.getElementById('companySignatureCanvas');
            const recipientCanvas = document.getElementById('recipientSignatureCanvas');
            
            if (companyCanvas && recipientCanvas) {
                companySignaturePad = new SignaturePad(companyCanvas, 'company');
                recipientSignaturePad = new SignaturePad(recipientCanvas, 'recipient');
            }
        }

        function clearSignature(type) {
            if (type === 'company') {
                companySignaturePad.clear();
            } else {
                recipientSignaturePad.clear();
            }
        }

        function undoSignature(type) {
            if (type === 'company') {
                companySignaturePad.undo();
            } else {
                recipientSignaturePad.undo();
            }
        }

        function preparePrintAndPrint() {
            // Update signature images for print
            if (!companySignaturePad.isEmpty()) {
                document.getElementById('companySignatureImage').src = 
                    document.getElementById('companySignatureData').value;
            }
            if (!recipientSignaturePad.isEmpty()) {
                document.getElementById('recipientSignatureImage').src = 
                    document.getElementById('recipientSignatureData').value;
            }
            
            setTimeout(() => {
                window.print();
            }, 100);
        }

        // Detect if embedded or standalone
        function isEmbedded() {
            try {
                return window.self !== window.top;
            } catch (e) {
                return true;
            }
        }

        // Add standalone class if not embedded
        if (!isEmbedded()) {
            document.body.classList.add('standalone');
        }

        // Smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';

        // Set today's date in generated date
        document.getElementById('generatedDate').textContent = new Date().toLocaleDateString('en-GB', {
            day: '2-digit',
            month: 'long',
            year: 'numeric'
        });

        // Auto-set today's date for signature dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('companySignatureDate').value = today;
        document.getElementById('recipientSignatureDate').value = today;

        // Reset form function
        function resetForm() {
            if (confirm('Are you sure you want to clear all form data including signatures?')) {
                document.getElementById('rebateForm').reset();
                companySignaturePad.clear();
                recipientSignaturePad.clear();
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'none';
            }
        }

        // Auto-fill recipient name from reference section
        document.getElementById('recipientName').addEventListener('input', function() {
            document.getElementById('fullName').value = this.value;
            document.getElementById('recipientSignatureName').textContent = this.value || '_______________________';
        });

        // Form submission handling
        const form = document.getElementById('rebateForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate signatures
            if (companySignaturePad.isEmpty()) {
                alert('Please provide company signature');
                return;
            }
            if (recipientSignaturePad.isEmpty()) {
                alert('Please provide recipient signature');
                return;
            }
            
            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Submitting...';
            
            // Hide previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            try {
                const formData = new FormData(form);
                
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    successMessage.style.display = 'block';
                    successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Optional: Reset form after successful submission
                    setTimeout(() => {
                        if (confirm('Form submitted successfully! Would you like to clear the form?')) {
                            form.reset();
                            companySignaturePad.clear();
                            recipientSignaturePad.clear();
                        }
                    }, 2000);
                } else {
                    throw new Error('Form submission failed');
                }
            } catch (error) {
                errorMessage.style.display = 'block';
                errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                console.error('Error:', error);
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = 'üì§ Submit Agreement';
            }
        });

        // Initialize signature pads when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initSignaturePads();
            console.log('Commission Rebate Agreement - Mode:', isEmbedded() ? 'Embedded' : 'Standalone');
            console.log('OSUS Real Estate Brokerage L.L.C - Document Ready');
            console.log('Formspree Integration Active');
            console.log('Digital Signature Pads Initialized');
        });

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Reinitialize signature pads on resize
                const companySigData = document.getElementById('companySignatureData').value;
                const recipientSigData = document.getElementById('recipientSignatureData').value;
                
                initSignaturePads();
                
                // Restore signatures if they existed
                if (companySigData) {
                    document.getElementById('companySignatureImage').src = companySigData;
                }
                if (recipientSigData) {
                    document.getElementById('recipientSignatureImage').src = recipientSigData;
                }
            }, 250);
        });
    </script>